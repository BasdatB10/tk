{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css2?family=Geist&family=Manrope:wght@400;600&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Jadwal Pakan | SIZOPI</title>
    <style>
        body {
            font-family: 'Manrope', sans-serif;
            font-weight: 600;
            letter-spacing: -0.02em;
        }
        .navbar {
            transition: all 0.3s ease;
        }
        .navbar-fixed {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .bg-texture {
            background-image: url("{% static 'images/texture-bg.jpg' %}");
            background-size: cover; 
            background-position: center; 
            background-repeat: no-repeat; 
            opacity: 0.15;
        }
        .main-container { 
            max-width: 1200px; 
            width: 100%; 
            padding: 2rem; 
            background-color: white; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); 
            border-radius: 8px; 
        }
        .form-container { 
            max-width: 700px; 
            width: 100%; 
            padding: 2rem; 
            background-color: white; 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); 
            border-radius: 8px; 
        }
        input, textarea, select { 
            width: 100%; 
            padding: 6px 10px; 
            margin-top: 0.5rem; 
            border: 1px solid #ccc; 
            border-radius: 8px; 
        }
        .form-button { 
            padding: 12px 24px; 
            font-size: 1rem; 
            border-radius: 8px; 
            cursor: pointer; 
        }
        .form-button:hover { 
            background-color: #ED8764; 
        }
        .alert { 
            padding: 10px 15px; 
            margin-bottom: 15px; 
            border-radius: 4px; 
        }
        .alert-success { 
            background-color: #d4edda; 
            border: 1px solid #c3e6cb; 
            color: #155724; 
        }
        .alert-danger { 
            background-color: #f8d7da; 
            border: 1px solid #f5c6cb; 
            color: #721c24; 
        }
        .modal { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: rgba(0, 0, 0, 0.5); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 1000; 
        }
        .hidden { 
            display: none;
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
        }
        table th, table td { 
            border: 1px solid #e0e0e0; 
            padding: 0.75rem; 
            text-align: left; 
        }
        table th { 
            background-color: #f8f9fa; 
            font-weight: 600; 
        }
        .action-button { 
            padding: 6px 12px; 
            border-radius: 4px; 
            font-size: 0.875rem; 
            cursor: pointer; 
            margin-right: 0.25rem;
        }
        .status-waiting { 
            color: #f39c12; 
            font-weight: bold; 
        }
    </style>
</head>
<body class="relative bg-white text-gray-800">
    {% include "navbar_penjaga_hewan.html" %}
    <div id="bg" class="bg-texture absolute inset-0 -z-10"></div>
    <div class="min-h-screen px-8 py-10 flex flex-col items-center max-w-7xl mx-auto">
        <div class="main-container space-y-6 w-full">
            <h2 class="text-3xl md:text-4xl font-extrabold text-[#883526] drop-shadow-md leading-tight text-center">
                Jadwal Pemberian Pakan
            </h2>
            
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <div class="flex items-center gap-4">
                <label for="animal-select" class="text-lg font-semibold text-[#49241B]">Pilih Hewan:</label>
                <select id="animal-select" class="w-64 text-lg">
                    <option value="" disabled selected>-- Pilih Hewan --</option>
                    {% for animal in hewan_data %}
                        <option value="{{ animal.0 }}">{{ animal.1 }}</option>
                    {% endfor %}
                </select>
                <button id="add-schedule-btn" class="form-button bg-[#FBBE99] text-white font-semibold">
                    + Tambah Jadwal
                </button>
            </div>

            <div id="animal-info" class="bg-gray-50 p-6 rounded-lg shadow-sm mb-6 hidden">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <div>
                        <p class="text-sm text-gray-500">ID Hewan</p>
                        <p class="font-semibold text-lg" id="animal-id">ID</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Nama</p>
                        <p class="font-semibold text-lg" id="animal-name">Nama</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Spesies</p>
                        <p class="font-semibold text-lg" id="animal-species">Spesies</p>
                    </div>
                </div>
            </div>

            <div id="schedules-content" class="space-y-6">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-[#883526]">Jadwal Pemberian Pakan (Menunggu)</h3>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th>Nama Hewan</th>
                                <th>Jenis Pakan</th>
                                <th>Jumlah (gram)</th>
                                <th>Jadwal</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pakan in pakan_data %}
                            <tr>
                                <td>{{ pakan.5 }}</td>
                                <td>{{ pakan.2 }}</td>
                                <td>{{ pakan.3 }}</td>
                                <td>{{ pakan.1|date:"d F Y H:i" }}</td>
                                <td class="status-waiting">{{ pakan.4 }}</td>
                                <td>
                                    <button onclick="giveFeed('{{ pakan.0 }}', '{{ pakan.1 }}')" 
                                            class="action-button bg-green-500 text-white">Beri Pakan</button>
                                    <button onclick="editSchedule('{{ pakan.0 }}', '{{ pakan.1 }}', '{{ pakan.2 }}', '{{ pakan.3 }}')" 
                                            class="action-button bg-blue-500 text-white">Edit</button>
                                    <button onclick="deleteSchedule('{{ pakan.0 }}', '{{ pakan.1 }}')" 
                                            class="action-button bg-red-500 text-white">Hapus</button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center text-gray-500 py-4">
                                    Belum ada jadwal pemberian pakan yang menunggu.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Jadwal -->
    <div id="add-schedule-modal" class="modal hidden">
        <div class="form-container bg-white">
            <h3 class="text-2xl font-bold text-[#883526] drop-shadow-md leading-tight text-center mb-6">
                Tambah Jadwal Pakan
            </h3>
            <form method="post" action="{% url 'medical_checkup_feeding:add_feeding_schedule' %}" class="space-y-6">
                {% csrf_token %}
                <div>
                    <label for="id_hewan" class="text-sm text-[#49241B]">Pilih Hewan:</label>
                    <select id="id_hewan" name="id_hewan" class="text-lg" required>
                        <option value="">-- Pilih Hewan --</option>
                        {% for animal in hewan_data %}
                            <option value="{{ animal.0 }}">{{ animal.1 }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="jenis_pakan" class="text-sm text-[#49241B]">Jenis Pakan:</label>
                    <input type="text" id="jenis_pakan" name="jenis_pakan" class="text-lg" required />
                </div>
                <div>
                    <label for="jumlah_pakan" class="text-sm text-[#49241B]">Jumlah Pakan (gram):</label>
                    <input type="number" id="jumlah_pakan" name="jumlah_pakan" min="1" class="text-lg" required />
                </div>
                <div>
                    <label for="jadwal" class="text-sm text-[#49241B]">Jadwal:</label>
                    <input type="datetime-local" id="jadwal" name="jadwal" class="text-lg" required />
                </div>
                <div class="flex justify-center gap-4 pt-4">
                    <button type="submit" class="form-button bg-[#FBBE99] text-white font-semibold">SIMPAN</button>
                    <button type="button" class="form-button bg-[#ED8764] text-white font-semibold close-modal">BATAL</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Edit Jadwal -->
    <div id="edit-schedule-modal" class="modal hidden">
        <div class="form-container bg-white">
            <h3 class="text-2xl font-bold text-[#883526] drop-shadow-md leading-tight text-center mb-6">
                Edit Jadwal Pakan
            </h3>
            <form method="post" id="edit-form" class="space-y-6">
                {% csrf_token %}
                <div>
                    <label for="jenis_pakan_baru" class="text-sm text-[#49241B]">Jenis Pakan Baru:</label>
                    <input type="text" id="jenis_pakan_baru" name="jenis_pakan_baru" class="text-lg" required />
                </div>
                <div>
                    <label for="jumlah_pakan_baru" class="text-sm text-[#49241B]">Jumlah Pakan Baru (gram):</label>
                    <input type="number" id="jumlah_pakan_baru" name="jumlah_pakan_baru" min="1" class="text-lg" required />
                </div>
                <div>
                    <label for="jadwal_baru" class="text-sm text-[#49241B]">Jadwal Baru:</label>
                    <input type="datetime-local" id="jadwal_baru" name="jadwal_baru" class="text-lg" required />
                </div>
                <div class="flex justify-center gap-4 pt-4">
                    <button type="submit" class="form-button bg-[#FBBE99] text-white font-semibold">SIMPAN</button>
                    <button type="button" class="form-button bg-[#ED8764] text-white font-semibold close-modal">BATAL</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Konfirmasi Hapus -->
    <div id="delete-modal" class="modal hidden">
        <div class="form-container bg-white">
            <h3 class="text-2xl font-bold text-[#883526] drop-shadow-md leading-tight text-center mb-6">
                Konfirmasi Penghapusan
            </h3>
            <p class="text-center mb-6">Apakah Anda yakin ingin menghapus jadwal pakan ini?</p>
            <form method="post" id="delete-form" class="space-y-6">
                {% csrf_token %}
                <input type="hidden" name="confirm_delete" value="YA" />
                <div class="flex justify-center gap-4 pt-4">
                    <button type="submit" class="form-button bg-red-500 text-white font-semibold">YA</button>
                    <button type="button" class="form-button bg-gray-500 text-white font-semibold close-modal">TIDAK</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Event listeners
        document.getElementById('add-schedule-btn').addEventListener('click', function() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('jadwal').min = tomorrow.toISOString().slice(0, 16);
            document.getElementById('add-schedule-modal').classList.remove('hidden');
        });

        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.add('hidden');
                });
            });
        });

        function editSchedule(idHewan, jadwal, jenis, jumlah) {
            document.getElementById('jenis_pakan_baru').value = jenis;
            document.getElementById('jumlah_pakan_baru').value = jumlah;
            
            // Format datetime for input
            const date = new Date(jadwal);
            const formattedDate = date.toISOString().slice(0, 16);
            document.getElementById('jadwal_baru').value = formattedDate;
            
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('jadwal_baru').min = tomorrow.toISOString().slice(0, 16);
            
            document.getElementById('edit-form').action = 
                "{% url 'medical_checkup_feeding:edit_feeding_schedule' '0' '0000-01-01T00:00:00' %}".replace('0/0000-01-01T00:00:00', idHewan + '/' + encodeURIComponent(jadwal));
            
            document.getElementById('edit-schedule-modal').classList.remove('hidden');
        }

        function deleteSchedule(idHewan, jadwal) {
            document.getElementById('delete-form').action = 
                "{% url 'medical_checkup_feeding:delete_feeding_schedule' '0' '0000-01-01T00:00:00' %}".replace('0/0000-01-01T00:00:00', idHewan + '/' + encodeURIComponent(jadwal));
            
            document.getElementById('delete-modal').classList.remove('hidden');
        }

        function giveFeed(idHewan, jadwal) {
            if (confirm('Apakah Anda yakin ingin memberikan pakan ini?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = "{% url 'medical_checkup_feeding:give_feeding' '0' '0000-01-01T00:00:00' %}".replace('0/0000-01-01T00:00:00', idHewan + '/' + encodeURIComponent(jadwal));
                
                const csrf = document.createElement('input');
                csrf.type = 'hidden';
                csrf.name = 'csrfmiddlewaretoken';
                csrf.value = '{{ csrf_token }}';
                form.appendChild(csrf);
                
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>
